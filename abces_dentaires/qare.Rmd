---
title: "Qare"
output: html_document
date: "2023-01-18"
---

```{r setup, include=FALSE}
library(tidyverse)
library(stringr)
library(openxlsx)

qare = read.xlsx("care_plateforme.xlsx", sheet = 1)
```

```{r data management, echo = F}
qare = qare %>% select(-c(ticked_cardio_vascular_family, ticked_asthma, ticked_stress, ticked_psycho, ticked_neuroleptics,
                ticked_bcg, ticked_diphtheria_polio, ticked_tetanus, ticked_pertussis, ticked_haemophilus,
                ticked_hepatitis_b, ticked_pneumococcus, ticked_meningitis_c, ticked_mmr, ticked_hpv, ticked_influenza,
                ticked_zona, ticked_food, ticked_diet, ticked_alcohol, ticked_cigarettes, ticked_exercise)) %>% 
    mutate(
        consultation_id = as.numeric(as.factor(consultation_id)),
        patient_id = as.numeric(as.factor(patient_id)),
        physician_id = as.numeric(as.factor(physician_id))
        )


```

- nb total de TC étudiées? `r length(unique(qare$consultation_id))` 
nb de patients ayant effectué ces TC?  
Répartition par mois du nb de TC?
Répartition par saison du nombre de TC?
proportion de TC ayant abouti à la prescription d’un antibio
dans les CIM10: créer une catégorie abcès/périondotite, une catégorie carie et une catégorie autre affections nombre de CIM 10 
pour chacune de ces 3 catégories donner le nombre et la proportion des TC?
durée moyenne des TC
nombre moyen de TC déjà réalisées par ces patients



# Age
```{r}
qare %>% 
    ggplot()+
    geom_bar(aes(x = patient_age_range))+
    scale_y_continuous(breaks = seq(0,1000,50))+
    labs(title = "Patient age distribution",
         y = "Count",
         x = "Age")

qare %>% 
    filter(!is.na(patient_gender)) %>% 
    ggplot()+
    geom_bar(aes(x = patient_age_range, fill = patient_gender), position = "dodge")+
    scale_y_continuous(breaks = seq(0,1000,50))+
    labs(title = "Patient age distribution by sex",
         y = "Count",
         x = "Age",
         fill = "Gender")


 #pivot_wider(names_from = patient_gender, values_from = c(n, "%")) %>% 
    #rename("F" = n_F,"M" = n_M,"NA" = n_NA,"F%" = `%_F`,"M%" = `%_M`,"NA%" = `%_NA`) %>% 
    #select(-contains("NA")) %>% 
    #mutate(F = paste(`F`," (",`F%`,"%)", sep = ""),
    #       M = paste(`M`," (",`M%`,"%)", sep = "")) %>% 
    #select(-`F%`, -`M%`) %>% 
    #rename("Age_category" = patient_age_range) %>% 

tab = qare %>% select(patient_gender,patient_age_range) 

ggplot(data = tab, aes(x=factor(patient_age_range),fill=patient_gender)) + 
    geom_bar(data=subset(tab, tab$patient_gender=="F"), position = "identity") + 
    geom_bar(data=subset(tab, tab$patient_gender=="M"),aes(y=after_stat(count)*(-1))) + 
    scale_y_continuous(breaks=seq(-1000,1000,100)) + 
    coord_flip()+
    labs()
```

